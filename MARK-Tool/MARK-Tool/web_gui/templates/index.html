<!DOCTYPE HTML>
<html>
    <head>
        <title>MARK</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" type="text/css" href="../static/css/style.css" />
        <link rel="stylesheet" type="text/css" href="../static/css/tabs.css" />
        <link rel="stylesheet" type="text/css" href="../static/css/loading-popup-style.css" />
        <script type="module" src="../static/js/analysis_main.js"></script>
        <script type="module" src="../static/js/file_requests.js"></script>
        <script type="module" src="../static/js/analysis_requests.js"></script>
        <script type="module" src="../static/js/loading-dialog-script.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const tabs = document.querySelectorAll(".tab");
                const inputForm = document.getElementById("input-form");
                const tablesWrapper = document.getElementById("tables-wrapper");

                function showTab(tabName) {
                    if (tabName === "Input") {
                        inputForm.style.display = "flex";
                        tablesWrapper.style.display = "none";
                    } else {
                        inputForm.style.display = "none";
                        tablesWrapper.style.display = "flex";
                    }
                    tabs.forEach(tab => tab.classList.remove("tab-active"));
                    document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add("tab-active");
                }

                tabs.forEach(tab => {
                    tab.addEventListener("click", function() {
                        showTab(tab.textContent.trim());
                    });
                });

                // Show Input tab by default
                showTab("Input");

                // File browse logic
                document.querySelectorAll('.browse-btn').forEach(function(btn) {
                    btn.addEventListener('click', function() {
                        const inputId = btn.getAttribute('data-input');
                        const fileInput = btn.nextElementSibling;
                        fileInput.click();
                        fileInput.onchange = function() {
                            if (fileInput.files.length > 0) {
                                document.getElementById(inputId).value = fileInput.files[0].path || fileInput.files[0].name;
                            }
                        };
                    });
                });
            });
        </script>
    </head>
    <body>
        <div class="tabbed-pane">
            <ul class="tabs-container">
                <li class="tab" data-tab="Input">
                    Input
                </li>
                <li id='output-tab' class="tab" data-tab="Output">
                    Output
                </li>
            </ul>
            <div class="tab-window">
                <form id="input-form">
                    <div class="input-row">
                        <label for="input_field">Input Folder:</label>
                        <input name="input_field" type="text" id="input_field">
                        <button type="button" class="browse-btn" data-input="input_field">Browse</button>
                        <input type="file" webkitdirectory directory multiple id="input_file" style="display:none;">
                    </div>
                    <div class="input-row">
                        <label for="output_field">Output Folder:</label>
                        <input name="output_field" type="text" id="output_field">
                        <button type="button" class="browse-btn" data-input="output_field">Browse</button>
                        <input type="file" id="output_file" style="display:none;">
                    </div>
                    <div class="input-row">
                        <label for="repo_field">GitHub Repo:</label>
                        <input name="repo_field" type="text" id="repo_field">
                        <button type="button" class="browse-btn" data-input="repo_field">Browse</button>
                        <input type="file" id="repo_file" style="display:none;">
                    </div>
                    <button type="button" id="start_analysis_btn">Start Analysis</button>
                </form>

                <div id="tables-wrapper" class="tables-wrapper" style="display: none;">
                    <fieldset class="titled-border">
                        <legend>Consumers</legend>
                        <div class="inner-border">
                            <table id="consumers-table">
                                <caption>CSV File</caption>
                            </table>
                        </div>
                    </fieldset>
                    <fieldset class="titled-border">
                        <legend>Producers</legend>
                        <div class="inner-border">
                            <table id="producers-table">
                                <caption>CSV File</caption>
                            </table>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
        <template id="loading-popup-template">
            <div id="loading-popup-container">
                <div class="loading-popup">
                    <button id="loading-popup-action-btn">Ok</button>
                    <div id="loading-content">
                        <div class="spinner" id="loading-spinner"></div>
                        <p id="loading-content-text">Loading...</p>
                    </div>
                </div>
            </div>
        </template>

        <template id ="csv-file-template">
            <div class="csv-file-main">
                <div class="csv-file-top-bar">
			        <p>pino_file.csv</p>
			        <button class="csv-close-button">X</button>
		        </div>
                <div class="csv-file-table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>ProjectName</th>
                                <th>Is ML consumer</th>
                                <th>where</th>
                                <th>keyword</th>
                                <th>line_number</th>
                                <th>libraries</th>
                                <th>keywords</th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
		        </div>
            </div>
        </template>
    </body>
</html>
